# webpack性能优化

* 开发环境性能优化
* 生产环境性能优化

## 开发环境性能优化

* 优化打包构建速度
  * HMR：模块热替换。构建时只有一个模块发生变化，那么只会重新构建这一个模块，其他模块使用之前的缓存（开发者体验更好）
* 优化代码调试
  * source-map：一种提供源代码到构建后代码映射技术（如果构建后代码出错了，通过映射可以追踪源代码错误）开发环境和生产环境都有各自适合的方案

## 生产环境性能优化

* 优化打包构建速度
  * oneOf：匹配到loader后就不再向后进行匹配，提升性能
  * babel缓存：优化打包构建速度，babel运行的结果会缓存起来，第二次重复打包时速度就会快一些
  * 多进程打包：某个任务消耗时间较长会卡顿，多进程可以同一时间干多件事，效率更高。优点提升打包速度；缺点每个进程的开启和交流都会有开销（babel-loader消耗时间最久，所以使用thread-loader针对其进行优化）
  * externals：让某些库不打包，通过cdn引入
  * dll：让某些库单独打包，后直接引入到build中。可以在code split分割出node_modules后再用dll更细的分割。
* 优化代码运行的性能
  * 缓存(hash-chunkhash-contenthash)：强制缓存一段时间不能撤回的资源，加入hash值到文件名称中作为一个版本号的作用，hash值改变说明需要重新请求
  区别：
  1.hash：打包一次hash变化一次；（改一个地方其他就都变了）
  2.chunkhash：打包来自同一个入口就同属于一个chunk也就同享一个hash值；（css文件是来自js文件引入的，hash一样，js变css也得变）
  3.contenthash：文件内容没变，hash值不变
  * tree shaking：树摇。去除程序中没有使用的代码，从而使体积更小，请求速度快，用户体验好
  * code split：代码分割。将打包输出的一个大的bundle.js文件拆分成多个小文件，这样可以并行加载多个文件，比加载一个文件更快。
  1. 单入口：
  可以将node_modules中代码单独打包一个chunk最终输出；
  webpackChunkName:指定test单独打包后文件的名字
  2. 多入口：自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk(比如两个模块中都引入了jquery会被打包成单独的文件)
  3. import动态导入语法：能将某个文件单独打包(test文件不会和index打包在同一个文件而是单独打包)
  * 懒加载/预加载：
  1. 懒加载：只要代码分割是在异步中执行的，它就会懒加载，一打开页面并不加载，等触发条件后才加载，不会影响主要代码的加载。
  2. 预加载：等其他资源加载完后再偷偷加载，优势在于不会卡顿，速度较快，但是兼容性问题很差
  * pwa：离线可访问技术（渐进式网络开发应用程序）用serviceworker和workbox技术，优点是离线也能访问，缺点是兼容性差
